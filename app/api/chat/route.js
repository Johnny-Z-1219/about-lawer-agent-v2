import { NextResponse } from 'next/server';

// æ¨¡æ‹Ÿæ›´å¤æ‚çš„æ³•å¾‹çŸ¥è¯†åº“
const legalKnowledgeBase = {
  // åˆåŒç›¸å…³
  'åˆåŒ': {
    keywords: ['åˆåŒ', 'åè®®', 'è¿çº¦', 'ç­¾çº¦', 'æ¡æ¬¾'],
    responses: [
      'å…³äºåˆåŒé—®é¢˜ï¼Œæˆ‘éœ€è¦äº†è§£æ›´å¤šè¯¦æƒ…ï¼š',
      '1. åˆåŒçš„æ€§è´¨ï¼ˆä¹°å–ã€ç§Ÿèµã€æœåŠ¡ç­‰ï¼‰',
      '2. äº‰è®®çš„å…·ä½“å†…å®¹',
      '3. åˆåŒç­¾è®¢æ—¶é—´å’Œå±¥è¡Œæƒ…å†µ',
      '4. ç›®å‰çš„æŸå¤±æƒ…å†µ',
      '',
      'ä¸€èˆ¬æ¥è¯´ï¼ŒåˆåŒçº çº·çš„å¤„ç†æ­¥éª¤ï¼š',
      'â€¢ æ”¶é›†ç›¸å…³è¯æ®ææ–™',
      'â€¢ å°è¯•åå•†è§£å†³',
      'â€¢ ç”³è¯·è°ƒè§£æˆ–ä»²è£',
      'â€¢ å¿…è¦æ—¶æèµ·è¯‰è®¼',
      '',
      'å»ºè®®æ‚¨å¸¦é½åˆåŒåŸä»¶åŠç›¸å…³è¯æ®ï¼Œé¢„çº¦é¢è°ˆè¯¦ç»†å’¨è¯¢ã€‚'
    ]
  },
  
  // å©šå§»å®¶åº­
  'ç¦»å©š': {
    keywords: ['ç¦»å©š', 'åˆ†å±…', 'è´¢äº§åˆ†å‰²', 'æŠšå…»æƒ', 'æŠšå…»è´¹'],
    responses: [
      'ç¦»å©šæ¡ˆä»¶æ˜¯ä¸€ä¸ªæ•æ„Ÿä¸”é‡è¦çš„å†³å®šï¼Œä¸»è¦æ¶‰åŠï¼š',
      '',
      'ğŸ“‹ ç¨‹åºæ–¹é¢ï¼š',
      'â€¢ åè®®ç¦»å©šï¼ˆæ°‘æ”¿å±€åŠç†ï¼‰',
      'â€¢ è¯‰è®¼ç¦»å©šï¼ˆæ³•é™¢å®¡ç†ï¼‰',
      '',
      'ğŸ’° è´¢äº§åˆ†å‰²ï¼š',
      'â€¢ å¤«å¦»å…±åŒè´¢äº§çš„è®¤å®š',
      'â€¢ æˆ¿äº§ã€è½¦è¾†ã€å­˜æ¬¾ç­‰åˆ†å‰²',
      'â€¢ å€ºåŠ¡çš„æ‰¿æ‹…',
      '',
      'ğŸ‘¶ å­å¥³é—®é¢˜ï¼š',
      'â€¢ æŠšå…»æƒçš„äº‰å–',
      'â€¢ æŠšå…»è´¹çš„æ ‡å‡†',
      'â€¢ æ¢è§†æƒçš„å®‰æ’',
      '',
      'å»ºè®®æ‚¨å‡†å¤‡å¥½è´¢äº§è¯æ˜ã€æ”¶å…¥è¯æ˜ç­‰ææ–™ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ‚¨åˆ¶å®šæœ€ä½³çš„æ³•å¾‹ç­–ç•¥ã€‚'
    ]
  },
  
  // åŠ³åŠ¨äº‰è®®
  'å·¥ä¼¤': {
    keywords: ['å·¥ä¼¤', 'å·¥ä½œ', 'åŠ³åŠ¨', 'è¾é€€', 'åŠ ç­', 'ç¤¾ä¿'],
    responses: [
      'å·¥ä¼¤æ¡ˆä»¶å¤„ç†æœ‰ä¸¥æ ¼çš„æ—¶æ•ˆè¦æ±‚ï¼š',
      '',
      'â° å…³é”®æ—¶é—´èŠ‚ç‚¹ï¼š',
      'â€¢ 30æ—¥å†…ç”³è¯·å·¥ä¼¤è®¤å®š',
      'â€¢ 15æ—¥å†…ç”³è¯·å¤è®®',
      'â€¢ 1å¹´å†…ç”³è¯·åŠ³åŠ¨ä»²è£',
      '',
      'ğŸ“‹ éœ€è¦å‡†å¤‡çš„ææ–™ï¼š',
      'â€¢ åŠ³åŠ¨åˆåŒæˆ–åŠ³åŠ¨å…³ç³»è¯æ˜',
      'â€¢ åŒ»ç–—è¯Šæ–­è¯æ˜',
      'â€¢ äº‹æ•…å‘ç”Ÿè¯æ˜',
      'â€¢ å·¥ä¼¤è®¤å®šç”³è¯·è¡¨',
      '',
      'ğŸ’µ èµ”å¿é¡¹ç›®åŒ…æ‹¬ï¼š',
      'â€¢ åŒ»ç–—è´¹ã€ä½é™¢è´¹',
      'â€¢ åœå·¥ç•™è–ªæœŸå·¥èµ„',
      'â€¢ ä¸€æ¬¡æ€§ä¼¤æ®‹è¡¥åŠ©é‡‘',
      'â€¢ æŠ¤ç†è´¹ç­‰',
      '',
      'å·¥ä¼¤æ¡ˆä»¶æ—¶æ•ˆæ€§å¾ˆå¼ºï¼Œå»ºè®®ç«‹å³å’¨è¯¢ä¸“ä¸šå¾‹å¸ˆã€‚'
    ]
  },
  
  // æˆ¿äº§çº çº·
  'æˆ¿äº§': {
    keywords: ['æˆ¿å­', 'æˆ¿äº§', 'ä¹°æˆ¿', 'ç§Ÿæˆ¿', 'æˆ¿å±‹', 'ç‰©ä¸š'],
    responses: [
      'æˆ¿äº§çº çº·ç±»å‹å¤šæ ·ï¼Œå¸¸è§é—®é¢˜åŒ…æ‹¬ï¼š',
      '',
      'ğŸ  ä¹°å–çº çº·ï¼š',
      'â€¢ åˆåŒè¿çº¦ï¼ˆé€¾æœŸäº¤æˆ¿ã€é€¾æœŸè¿‡æˆ·ï¼‰',
      'â€¢ æˆ¿å±‹è´¨é‡é—®é¢˜',
      'â€¢ ä¸­ä»‹è´¹ç”¨äº‰è®®',
      '',
      'ğŸ  ç§Ÿèµçº çº·ï¼š',
      'â€¢ æŠ¼é‡‘é€€è¿˜é—®é¢˜',
      'â€¢ ç§Ÿé‡‘ä¸Šæ¶¨äº‰è®®',
      'â€¢ æå‰è§£çº¦è´£ä»»',
      '',
      'ğŸ  ç‰©ä¸šçº çº·ï¼š',
      'â€¢ ç‰©ä¸šè´¹æ”¶è´¹äº‰è®®',
      'â€¢ æœåŠ¡è´¨é‡é—®é¢˜',
      'â€¢ ç»´ä¿®è´£ä»»è®¤å®š',
      '',
      'æˆ¿äº§é—®é¢˜å¾€å¾€æ¶‰åŠé‡‘é¢è¾ƒå¤§ï¼Œå»ºè®®ä¿ç•™å¥½ç›¸å…³è¯æ®ï¼ŒåŠæ—¶å¯»æ±‚ä¸“ä¸šæ³•å¾‹å¸®åŠ©ã€‚'
    ]
  },
  
  // æ”¶è´¹å’¨è¯¢
  'æ”¶è´¹': {
    keywords: ['è´¹ç”¨', 'æ”¶è´¹', 'å¤šå°‘é’±', 'ä»·æ ¼', 'å¾‹å¸ˆè´¹'],
    responses: [
      'å¾‹å¸ˆæ”¶è´¹é‡‡ç”¨å¤šç§æ–¹å¼ï¼š',
      '',
      'ğŸ’° æ”¶è´¹æ ‡å‡†ï¼š',
      'â€¢ æ³•å¾‹å’¨è¯¢ï¼š300-500å…ƒ/å°æ—¶',
      'â€¢ ç®€å•æ¡ˆä»¶ä»£ç†ï¼š3000-8000å…ƒ',
      'â€¢ å¤æ‚æ¡ˆä»¶ä»£ç†ï¼šæŒ‰æ ‡çš„é¢æ¯”ä¾‹æ”¶è´¹',
      'â€¢ å¸¸å¹´æ³•å¾‹é¡¾é—®ï¼šé¢è®®',
      '',
      'ğŸ“‹ å½±å“æ”¶è´¹çš„å› ç´ ï¼š',
      'â€¢ æ¡ˆä»¶å¤æ‚ç¨‹åº¦',
      'â€¢ äº‰è®®é‡‘é¢å¤§å°',
      'â€¢ å·¥ä½œé‡å’Œæ—¶é—´æŠ•å…¥',
      'â€¢ å¾‹å¸ˆçš„ä¸“ä¸šæ°´å¹³',
      '',
      'ğŸ¯ ä¼˜æƒ æ”¿ç­–ï¼š',
      'â€¢ é¦–æ¬¡å’¨è¯¢å¯äº«å—åŠä»·ä¼˜æƒ ',
      'â€¢ å¤šæ¡ˆä»¶å§”æ‰˜æœ‰æŠ˜æ‰£',
      'â€¢ å›°éš¾ç¾¤ä½“å¯ç”³è¯·å‡å…',
      '',
      'å…·ä½“è´¹ç”¨éœ€è¦æ ¹æ®æ‚¨çš„å…·ä½“æƒ…å†µç¡®å®šï¼Œæ¬¢è¿é¢„çº¦è¯¦ç»†å’¨è¯¢ã€‚'
    ]
  }
};

// åˆ†æç”¨æˆ·æ¶ˆæ¯å¹¶ç”Ÿæˆå›å¤
function generateResponse(userMessage) {
  const message = userMessage.toLowerCase();
  
  // æŸ¥æ‰¾åŒ¹é…çš„çŸ¥è¯†æ¡ç›®
  for (const [category, data] of Object.entries(legalKnowledgeBase)) {
    if (data.keywords.some(keyword => message.includes(keyword))) {
      return data.responses.join('\n');
    }
  }
  
  // ç‰¹æ®Šé—®é¢˜å¤„ç†
  if (message.includes('é¢„çº¦') || message.includes('å’¨è¯¢')) {
    return [
      'ğŸ“ é¢„çº¦å’¨è¯¢æ–¹å¼ï¼š',
      '',
      'ğŸ•˜ å·¥ä½œæ—¶é—´ï¼šå‘¨ä¸€è‡³å‘¨äº” 9:00-18:00',
             'ğŸ“ å’¨è¯¢ç”µè¯ï¼š0566-5021766',
       'ğŸ“§ é‚®ç®±é¢„çº¦ï¼š2548365492@qq.com',
       'ğŸ“ åŠå…¬åœ°å€ï¼šå®‰å¾½çœæ± å·å¸‚é’é˜³å¿ä¹åè¥¿è·¯194å·æ–‡åŒ–é¦†äºŒæ¥¼',
      '',
      'ğŸ’¡ é¢„çº¦æ—¶è¯·å‡†å¤‡ï¼š',
      'â€¢ ç®€è¦æè¿°æ¡ˆä»¶æ€§è´¨',
      'â€¢ è¯´æ˜é¢„æœŸå’¨è¯¢æ—¶é—´',
      'â€¢ æä¾›è”ç³»æ–¹å¼',
      '',
      'é¦–æ¬¡å’¨è¯¢äº«å—åŠä»·ä¼˜æƒ ï¼Œæˆ‘ä»¬ä¼šä¸ºæ‚¨æä¾›ä¸“ä¸šçš„æ³•å¾‹åˆ†æå’Œå»ºè®®ã€‚'
    ].join('\n');
  }
  
  if (message.includes('ä½ å¥½') || message.includes('hello')) {
    return [
      'æ‚¨å¥½ï¼æ¬¢è¿å’¨è¯¢å®‰å¾½ä¿®å®å¾‹å¸ˆäº‹åŠ¡æ‰€ï¼ğŸ‘‹',
      '',
      'æˆ‘æ˜¯æ‚¨çš„ä¸“ä¸šæ³•å¾‹åŠ©æ‰‹ï¼Œå¯ä»¥ä¸ºæ‚¨æä¾›ï¼š',
      'â€¢ åŸºç¡€æ³•å¾‹é—®é¢˜è§£ç­”',
      'â€¢ æ¡ˆä»¶ç±»å‹åˆ†æ',
      'â€¢ æ³•å¾‹é£é™©æç¤º',
      'â€¢ é¢„çº¦å’¨è¯¢æœåŠ¡',
      '',
      'è¯·å‘Šè¯‰æˆ‘æ‚¨é‡åˆ°çš„å…·ä½“æ³•å¾‹é—®é¢˜ï¼Œæˆ‘ä¼šå°½åŠ›ä¸ºæ‚¨æä¾›ä¸“ä¸šå»ºè®®ã€‚'
    ].join('\n');
  }
  
  // é»˜è®¤æ™ºèƒ½å›å¤
  return [
    'æ„Ÿè°¢æ‚¨çš„å’¨è¯¢ï¼ğŸ™',
    '',
    'æ ¹æ®æ‚¨æè¿°çš„æƒ…å†µï¼Œå»ºè®®æ‚¨ï¼š',
    '',
    '1ï¸âƒ£ è¯¦ç»†æ•´ç†ç›¸å…³äº‹å®å’Œè¯æ®ææ–™',
    '2ï¸âƒ£ æ˜ç¡®æ‚¨å¸Œæœ›è¾¾åˆ°çš„ç›®æ ‡',
    '3ï¸âƒ£ é¢„çº¦ä¸“ä¸šå¾‹å¸ˆè¿›è¡Œè¯¦ç»†å’¨è¯¢',
    '',
    'æ¯ä¸ªæ¡ˆä»¶éƒ½æœ‰å…¶ç‰¹æ®Šæ€§ï¼Œä¸ºäº†ç»™æ‚¨æœ€å‡†ç¡®çš„æ³•å¾‹å»ºè®®ï¼Œ',
    'å»ºè®®æ‚¨é¢„çº¦é¢è°ˆï¼Œæˆ‘ä»¬ä¼šä¸ºæ‚¨åˆ¶å®šä¸ªæ€§åŒ–çš„è§£å†³æ–¹æ¡ˆã€‚',
    '',
         'ğŸ“ é¢„çº¦ç”µè¯ï¼š0566-5021766',
     'ğŸ“§ é¢„çº¦é‚®ç®±ï¼š2548365492@qq.com'
  ].join('\n');
}

export async function POST(request) {
  try {
    const { message } = await request.json();
    
    if (!message || typeof message !== 'string') {
      return NextResponse.json(
        { error: 'è¯·æä¾›æœ‰æ•ˆçš„æ¶ˆæ¯å†…å®¹' },
        { status: 400 }
      );
    }
    
    // æ¨¡æ‹Ÿå¤„ç†æ—¶é—´
    await new Promise(resolve => setTimeout(resolve, 500 + Math.random() * 1500));
    
    const response = generateResponse(message);
    
    return NextResponse.json({
      success: true,
      response: response,
      timestamp: new Date().toISOString()
    });
    
  } catch (error) {
    console.error('Chat API Error:', error);
    return NextResponse.json(
      { error: 'æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•' },
      { status: 500 }
    );
  }
} 